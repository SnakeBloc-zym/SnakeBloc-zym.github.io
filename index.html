<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>é™¨æ˜Ÿ - é¢˜ç›®æŸ¥çœ‹å™¨</title>
	<!-- Katex CSS -->
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/katex.min.css">
	<!-- Highlight.js CSS -->
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
	<script src="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
	<!-- Giscus CSS -->
	<link rel="stylesheet" href="https://unpkg.com/giscus@1.3.0/dist/giscus.css">
	<link rel="shortcut icon" href="https://cdn.luogu.com.cn/upload/usericon/1393230.png">
	<script src="https://cdn.jsdmirror.com/npm/anchor-js/anchor.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
	<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css">
	<script src="https://cdn.jsdmirror.com/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		body {
			background: linear-gradient(135deg, #0c0c2e 0%, #1a1a3e 50%, #0c0c2e 100%);
			color: #e0e0e0;
			min-height: 100vh;
			padding: 20px;
			background-image:
				radial-gradient(circle at 10% 20%, rgba(28, 58, 112, 0.15) 0%, transparent 20%),
				radial-gradient(circle at 90% 80%, rgba(112, 28, 88, 0.15) 0%, transparent 20%);
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
		}

		header {
			text-align: center;
			margin-bottom: 40px;
			padding: 20px;
		}

		h1 {
			font-size: 3.5rem;
			background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
			-webkit-background-clip: text;
			background-clip: text;
			color: transparent;
			margin-bottom: 10px;
			text-shadow: 0 0 20px rgba(106, 17, 203, 0.5);
			letter-spacing: 2px;
		}

		.subtitle {
			font-size: 1.2rem;
			color: #a0a0c0;
			margin-bottom: 30px;
		}

		.content-grid {
			display: grid;
			grid-template-columns: 1fr;
			gap: 30px;
		}

		@media (min-width: 768px) {
			.content-grid {
				grid-template-columns: repeat(2, 1fr);
			}

			.intro-box {
				grid-column: 1 / 2;
			}

			.new-problems-box {
				grid-column: 2 / 3;
			}

			.comments-box {
				grid-column: 1 / 3;
			}
		}

		.box {
			background: rgba(25, 25, 50, 0.7);
			backdrop-filter: blur(10px);
			border-radius: 15px;
			padding: 25px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
			border: 1px solid rgba(100, 100, 200, 0.2);
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}

		.box:hover {
			transform: translateY(-5px);
			box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
		}

		.box-title {
			font-size: 1.8rem;
			margin-bottom: 20px;
			color: #6a8cff;
			border-bottom: 2px solid rgba(106, 140, 255, 0.3);
			padding-bottom: 10px;
			display: flex;
			align-items: center;
		}

		.box-title i {
			margin-right: 10px;
			font-size: 1.5rem;
		}

		.markdown-content {
			line-height: 1.6;
		}

		.markdown-content h1,
		.markdown-content h2,
		.markdown-content h3 {
			margin: 20px 0 10px 0;
			color: #8a9bff;
		}

		.markdown-content p {
			margin-bottom: 15px;
		}

		.markdown-content code {
			background: rgba(0, 0, 0, 0.3);
			padding: 2px 6px;
			border-radius: 4px;
			font-family: 'Courier New', monospace;
		}

		.markdown-content pre {
			background: rgba(0, 0, 0, 0.4);
			padding: 15px;
			border-radius: 8px;
			overflow-x: auto;
			margin: 15px 0;
		}

		.problem-list {
			list-style-type: none;
		}

		.problem-item {
			padding: 15px;
			margin-bottom: 15px;
			background: rgba(40, 40, 70, 0.5);
			border-radius: 8px;
			transition: background 0.3s ease;
		}

		.problem-item:hover {
			background: rgba(50, 50, 90, 0.7);
		}

		.problem-link {
			color: #6a8cff;
			text-decoration: none;
			font-size: 1.1rem;
			display: block;
			margin-bottom: 5px;
		}

		.problem-link:hover {
			color: #8aafff;
			text-decoration: underline;
		}

		.problem-meta {
			font-size: 0.9rem;
			color: #a0a0c0;
			display: flex;
			justify-content: space-between;
		}

		.giscus-comments {
			min-height: 400px;
		}

		footer {
			text-align: center;
			margin-top: 50px;
			padding: 20px;
			color: #7070a0;
			font-size: 0.9rem;
		}

		.loading {
			text-align: center;
			padding: 20px;
			color: #a0a0c0;
		}

		.error {
			color: #ff6b6b;
			padding: 10px;
			background: rgba(255, 107, 107, 0.1);
			border-radius: 5px;
			margin: 10px 0;
		}

		pre code {
			font-family: 'Consolas';
			display: block;
			padding: 12px;
			padding-left: 20px;
			margin: 2rem 0;
			background: #f8fafc;
			border-radius: 10px;
			border: 1px solid #e2e8f0;
			overflow-x: auto;
			overflow-y: auto;
			line-height: 1.6 !important;
			font-size: 0.95rem !important;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
		}

		table {
			border-collapse: collapse !important;
			border-spacing: 0 !important;
			overflow-x: auto;
			min-width: 600px !important;
			font-size: 1rem !important;
			width: 100%;
			margin: 2rem 0;
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			border: 1px solid #e2e8f0;
			background: white;
		}

		thead {
			display: table-header-group;
			vertical-align: middle;
			unicode-bidi: isolate;
			border-color: inherit;
			border-radius: 10px;
		}

		tbody {
			border-radius: 10px;
		}

		tr {
			display: table-row;
			vertical-align: inherit;
			unicode-bidi: isolate;
			border-color: inherit;
		}

		th {
			background: #f8fafc !important;
			font-weight: 600 !important;
			color: #374151 !important;
			border-bottom: 2px solid #e2e8f0 !important;
		}

		th,
		td {
			padding: 12px 16px !important;
			font-size: 1rem !important;
			border-bottom: 1px solid #e2e8f0;
			border-right: 1px solid rgba(34, 36, 38, .1);
			white-space: nowrap;
		}

		table tbody tr:hover {
			background-color: #f8fafc;
		}

		.codecopy-btn {
			opacity: 0.7 !important;
			min-height: 1em;
			outline: 0;
			vertical-align: baseline;
			position: absolute;
			top: 10px !important;
			right: 10px !important;
			background: #f8fafc;
			padding: 6px 10px !important;
			color: rgba(0, 0, 0, 0.6);
			border: 1px solid rgba(0, 0, 0, 0.1);
			box-shadow: transparent 0px 0px 0px 1px inset, rgba(34, 36, 38, 0.15) 0px 0px 0px 0px inset;
			cursor: pointer;
			z-index: 10;
			text-transform: none;
			text-shadow: none;
			font-weight: 700;
			line-height: 1em;
			font-style: normal;
			text-align: center;
			text-decoration: none;
			border-radius: .28571429rem;
			font-size: 0.8rem !important;
			display: inline-block !important;
			padding-block: 1px;
			padding-inline: 6px;
			margin: 0 .25em 0 0;
		}

		.codecopy-btn icon {
			font-weight: 0.8rem !important;
		}

		.codecopy-btn:active {
			background-color: rgb(186, 187, 188);
			color: rgba(0, 0, 0, 0.9);
		}

		.codecopy-btn:hover {
			background: #fff;
			transform: translateY(-1px);
			background-color: rgb(202, 203, 205);
			box-shadow: transparent 0px 0px 0px 1px inset, rgba(34, 36, 38, 0.15) 0px 0px 0px 0px inset;
			color: rgba(0, 0, 0, 0.8);
		}

		.codecopy-btn:focus {
			background-color: rgb(202, 203, 205);
			color: rgba(0, 0, 0, 0.8);
		}
	</style>
</head>

<body>
	<div class="container">
		<header>
			<h1>é™¨æ˜Ÿ</h1>
			<div class="subtitle">Markdown + Katex + Hljs é¢˜ç›®æŸ¥çœ‹å™¨</div>
		</header>

		<div class="content-grid">
			<div class="box intro-box">
				<h2 class="box-title">ğŸ“– ä»‹ç»</h2>
				<div class="markdown-content" id="intro-content">
					<div class="loading">åŠ è½½ä¸­...</div>
				</div>
			</div>

			<div class="box new-problems-box">
				<h2 class="box-title">ğŸ†• æœ€æ–°é¢˜ç›®</h2>
				<div id="new-problems-content">
					<div class="loading">åŠ è½½ä¸­...</div>
				</div>
			</div>

			<div class="box comments-box">
				<h2 class="box-title">ğŸ’¬ è¯„è®º</h2>
				<div class="giscus-comments" id="giscus-comments">
					<!-- Giscusè¯„è®ºç³»ç»Ÿå°†åœ¨è¿™é‡ŒåŠ è½½ -->
				</div>
			</div>
		</div>

		<footer>
			<p>é™¨æ˜Ÿé¢˜ç›®æŸ¥çœ‹å™¨ &copy; 2023 | æ”¯æŒ Markdown + Katex + Hljs æ¸²æŸ“</p>
		</footer>
	</div>

	<!-- Marked.js for Markdown parsing -->
	<script src="https://cdn.jsdmirror.com/npm/marked/marked.min.js"></script>
	<!-- Katex for math rendering -->
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/katex.min.js"></script>
	<!-- Katex auto-render script -->
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
	<!-- Giscus for comments -->
	<script src="https://unpkg.com/giscus@1.3.0/dist/giscus.js"></script>

	<script>
		// é…ç½®Marked.jsä»¥æ”¯æŒKatexå’Œä»£ç é«˜äº®
		marked.setOptions({
			highlight: function (code, lang) {
				if (lang && hljs.getLanguage(lang)) {
					return hljs.highlight(code, { language: lang }).value;
				}
				return hljs.highlightAuto(code).value;
			},
			gfm: true
		});

		function addCopyButtons() {
			const preElements = document.querySelectorAll('pre code');
			preElements.forEach(codeElement => {
				const button = document.createElement('button');
				button.innerHTML = '<i class="fa-solid fa-copy"></i>';
				button.classList.add('codecopy-btn');

				const div = document.createElement('div');
				div.style = "width:100%;position:relative;";
				div.appendChild(button);
				codeElement.before(div);

				new ClipboardJS(button, {
					text: () => codeElement.innerText.replace(/\n\n/g, "\n")
				}).on('success', e => {
					e.trigger.innerHTML = '<i class="fa-solid fa-check"></i>';
					setTimeout(() => e.trigger.innerHTML = '<i class="fa-solid fa-copy"></i>', 1000);
				}).on('error', e => {
					e.trigger.innerHTML = '<i class="fa-solid fa-xmark"></i>';
					setTimeout(() => e.trigger.innerHTML = '<i class="fa-solid fa-copy"></i>', 1000);
				});
			});
		}

		// æ¸²æŸ“Katexå…¬å¼
		async function renderMath(element) {
			if (window.renderMathInElement) {
				// ç¡®ä¿KaTeXå®Œå…¨åŠ è½½åæ‰æ¸²æŸ“
				if (window.katex) {
					renderMathInElement(element, {
						delimiters: [
							{ left: "$$", right: "$$", display: true },
							{ left: "\\[", right: "\\]", display: true },
							{ left: "\\(", right: "\\)", display: false },
							{ left: "$", right: "$", display: false }
						],
						throwOnError: false
					});
				} else {
					console.warn("KaTeX core not loaded yet.");
					// å»¶è¿Ÿæ¸²æŸ“
					setTimeout(() => renderMath(element), 100);
				}
			} else {
				console.warn("KaTeX auto-render script not loaded yet.");
				// å»¶è¿Ÿæ¸²æŸ“
				setTimeout(() => renderMath(element), 100);
			}
			addCopyButtons();
		}

		// åŠ è½½ä»‹ç»å†…å®¹
		async function loadIntro() {
			try {
				const response = await fetch('./sources/index.md');
				if (!response.ok) throw new Error('æ— æ³•åŠ è½½ä»‹ç»å†…å®¹');

				const markdown = await response.text();
				const introContent = document.getElementById('intro-content');
				introContent.innerHTML = marked.parse(markdown);

				// ç­‰å¾…DOMæ›´æ–°åæ¸²æŸ“å…¬å¼
				await new Promise(resolve => setTimeout(resolve, 0));
				await renderMath(introContent);
			} catch (error) {
				document.getElementById('intro-content').innerHTML =
					`<div class="error">åŠ è½½ä»‹ç»å†…å®¹æ—¶å‡ºé”™: ${error.message}</div>`;
			}
		}

		// åŠ è½½æœ€æ–°é¢˜ç›®
		async function loadNewProblems() {
			try {
				const response = await fetch('./sources/newp.json');
				if (!response.ok) throw new Error('æ— æ³•åŠ è½½æœ€æ–°é¢˜ç›®');

				const data = await response.json();
				const problemsContent = document.getElementById('new-problems-content');

				if (data.problems && data.problems.length > 0) {
					let html = '<ul class="problem-list">';
					data.problems.forEach(problem => {
						html += `
                            <li class="problem-item">
                                <a href="problem.html?id=${problem.id}" class="problem-link">${problem.title}</a>
                                <div class="problem-meta">
                                    <span>éš¾åº¦: ${problem.difficulty}</span>
                                    <span>${problem.date}</span>
                                </div>
                            </li>
                        `;
					});
					html += '</ul>';
					problemsContent.innerHTML = html;
				} else {
					problemsContent.innerHTML = '<p>æš‚æ— æœ€æ–°é¢˜ç›®</p>';
				}
			} catch (error) {
				document.getElementById('new-problems-content').innerHTML =
					`<div class="error">åŠ è½½æœ€æ–°é¢˜ç›®æ—¶å‡ºé”™: ${error.message}</div>`;
			}
		}

		// åˆå§‹åŒ–Giscusè¯„è®ºç³»ç»Ÿ
		function initGiscus() {
			const giscusContainer = document.getElementById('giscus-comments');

			// åˆ›å»ºGiscusè„šæœ¬å…ƒç´ 
			const script = document.createElement('script');
			script.src = 'https://giscus.app/client.js';
			script.setAttribute('data-repo', '[åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»“åº“]');
			script.setAttribute('data-repo-id', '[åœ¨æ­¤è¾“å…¥ä»“åº“ID]');
			script.setAttribute('data-category', '[åœ¨æ­¤è¾“å…¥åˆ†ç±»]');
			script.setAttribute('data-category-id', '[åœ¨æ­¤è¾“å…¥åˆ†ç±»ID]');
			script.setAttribute('data-mapping', 'pathname');
			script.setAttribute('data-strict', '0');
			script.setAttribute('data-reactions-enabled', '1');
			script.setAttribute('data-emit-metadata', '0');
			script.setAttribute('data-input-position', 'bottom');
			script.setAttribute('data-theme', 'dark');
			script.setAttribute('data-lang', 'zh-CN');
			script.setAttribute('crossorigin', 'anonymous');
			script.async = true;

			giscusContainer.appendChild(script);
		}

		// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
		document.addEventListener('DOMContentLoaded', () => {
			loadIntro();
			loadNewProblems();
			initGiscus();
		});

		document.addEventListener('DOMContentLoaded', () => {
			if (window.renderMathInElement) {
				renderMathInElement(document.body, {
					delimiters: [
						{ left: "$$", right: "$$", display: true },
						{ left: "\\[", right: "\\]", display: true },
						{ left: "\\(", right: "\\)", display: false },
						{ left: "$", right: "$", display: false }
					],
					throwOnError: false
				});
			}
		});
	</script>

	<script>
		// ç¡®ä¿æ‰€æœ‰åº“éƒ½åŠ è½½å®Œæˆåæ¸²æŸ“é¡µé¢ä¸­çš„æ•°å­¦å…¬å¼
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', renderAllMath);
		} else {
			// DOM å·²ç»åŠ è½½å®Œæˆ
			setTimeout(renderAllMath, 100);
		}

		function renderAllMath() {
			if (window.katex && window.renderMathInElement) {
				// ç­‰å¾…æ‰€æœ‰å†…å®¹å®Œå…¨æ¸²æŸ“
				setTimeout(() => {
					renderMathInElement(document.body, {
						delimiters: [
							{ left: "$$", right: "$$", display: true },
							{ left: "\\[", right: "\\]", display: true },
							{ left: "\\(", right: "\\)", display: false },
							{ left: "$", right: "$", display: false }
						],
						throwOnError: false
					});
				}, 200); // ç»™Marked.jsä¸€äº›æ—¶é—´æ¸²æŸ“Markdown
			} else {
				// å¦‚æœåº“è¿˜æ²¡åŠ è½½å®Œï¼Œå†ç­‰ä¸€ä¸‹
				setTimeout(renderAllMath, 100);
			}
		}
	</script>

	<script>
		// æ£€æµ‹æ˜¯å¦ä¸ºé¢˜ç›®é¡µé¢
		const urlParams = new URLSearchParams(window.location.search);
		const problemId = urlParams.get('id');

		if (problemId) {
			// é¢˜ç›®é¡µé¢
			document.querySelector('.intro-box').style.display = 'none';
			document.querySelector('.new-problems-box').style.display = 'none';

			const problemBox = document.createElement('div');
			problemBox.className = 'box';
			problemBox.innerHTML = `
      <h2 class="box-title">é¢˜ç›®: ${problemId}</h2>
      <div class="markdown-content" id="problem-content">
        <div class="loading">åŠ è½½ä¸­...</div>
      </div>
    `;
			document.querySelector('.content-grid').insertBefore(problemBox, document.querySelector('.comments-box'));

			// åŠ è½½é¢˜ç›®å†…å®¹
			fetch(`./sources/problem/${problemId}.md`)
				.then(response => {
					if (!response.ok) throw new Error('é¢˜ç›®ä¸å­˜åœ¨');
					return response.text();
				})
				.then(markdown => {
					document.getElementById('problem-content').innerHTML = marked.parse(markdown);
					// æ¸²æŸ“KaTeXå…¬å¼
					if (window.renderMathInElement) {
						renderMathInElement(document.getElementById('problem-content'), {
							delimiters: [
								{ left: "$$", right: "$$", display: true },
								{ left: "\\[", right: "\\]", display: true },
								{ left: "\\(", right: "\\)", display: false },
								{ left: "$", right: "$", display: false }
							],
							throwOnError: false
						});
					}
				})
				.catch(error => {
					document.getElementById('problem-content').innerHTML =
						`<div class="error">åŠ è½½é¢˜ç›®æ—¶å‡ºé”™: ${error.message}</div>`;
				});
		} else {
			// ä¸»é¡µï¼Œä¿®å¤åŠ è½½é—®é¢˜
			// GitHub Pages éœ€è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„
			loadIntro();
			loadNewProblems();
			initGiscus();
		}

		// ç¡®ä¿æ‰€æœ‰åº“éƒ½åŠ è½½å®Œæˆåæ¸²æŸ“é¡µé¢ä¸­çš„æ•°å­¦å…¬å¼
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', renderAllMath);
		} else {
			setTimeout(renderAllMath, 100);
		}

		function renderAllMath() {
			if (window.katex && window.renderMathInElement) {
				setTimeout(() => {
					renderMathInElement(document.body, {
						delimiters: [
							{ left: "$$", right: "$$", display: true },
							{ left: "\\[", right: "\\]", display: true },
							{ left: "\\(", right: "\\)", display: false },
							{ left: "$", right: "$", display: false }
						],
						throwOnError: false
					});
				}, 200);
			} else {
				setTimeout(renderAllMath, 100);
			}
		}
	</script>
</body>

</html>
