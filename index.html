<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>陨星</title>
	<!-- Katex CSS -->
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/katex.min.css">
	<!-- Highlight.js CSS -->
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
	<script src="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
	<!-- Giscus CSS -->
	<link rel="stylesheet" href="https://unpkg.com/giscus@1.3.0/dist/giscus.css">
	<link rel="shortcut icon" href="https://cdn.luogu.com.cn/upload/usericon/1393230.png">
	<script src="https://cdn.jsdmirror.com/npm/anchor-js/anchor.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
	<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css">
	<script src="https://cdn.jsdmirror.com/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css">
	<style>
		@font-face {
			font-family: 'Caveat';
			src: url('https://jsd-proxy.ygxz.in/gh/googlefonts/caveat/fonts/ttf/Caveat-Regular.ttf') format('truetype');
			font-weight: 400;
			font-style: normal;
			font-display: swap
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			min-height: 100vh;
			padding: 20px;
			font-family: LXGW Wenkai Screen;
		}


		.header {
			color: #555;
			padding: 15px 0;
			background: linear-gradient(90deg, #ffffff 0%, #f0f8ff 100%);
			box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
			display: flex;
			justify-content: space-between;
			align-items: center;
			position: fixed;
			width: 100%;
			z-index: 1000;
			margin-left: -20px !important;
			top: 0
		}

		.logo {
			font-size: 32px;
			font-weight: bold;
			margin-left: 20px;
			font-family: 'Caveat'
		}

		.container {
			margin-top: 50px !important;
			margin: 0 auto;
		}

		.subtitle {
			font-size: 1.2rem;
			margin-bottom: 30px;
		}

		.content-grid {
			display: grid;
			grid-template-columns: 1fr;
			gap: 30px;
		}

		@media (min-width: 768px) {
			.content-grid {
				grid-template-columns: repeat(2, 1fr);
			}

			.intro-box {
				grid-column: 1 / 3;
			}

			.new-problems-box {
				grid-column: 1 / 3;
			}

			.comments-box {
				grid-column: 1 / 3;
			}
		}

		h1 {
			color: #2c3e50;
			border-bottom: 2px solid #3498db;
			padding-bottom: 10px;
		}

		.box {
			/* background: rgba(255, 255, 255, 0.7); */
			/* backdrop-filter: blur(10px); */
			border-radius: 15px;
			padding: 25px;
			margin-left: 80px;
			/* box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); */
			/* border: 1px solid rgba(100, 100, 200, 0.2); */
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}

		.box-title {
			font-size: 1.8rem;
			margin-bottom: 20px;
			border-bottom: 2px solid rgba(106, 140, 255, 0.3);
			padding-bottom: 10px;
			display: flex;
			align-items: center;
		}

		.box-title i {
			margin-right: 10px;
			font-size: 1.5rem;
		}

		.markdown-content {
			line-height: 1.6;
		}

		.markdown-content h1,
		.markdown-content h2,
		.markdown-content h3 {
			margin: 20px 0 10px 0;
		}

		.markdown-content p {
			margin-bottom: 15px;
		}

		ul {
			display: block;
			/* list-style-type: disc; */
			margin-block-start: 1em;
			margin-block-end: 1em;
			padding-inline-start: 40px;
			unicode-bidi: isolate;
		}

		ol {
			display: block;
			/* list-style-type: decimal; */
			margin-block-start: 1em;
			margin-block-end: 1em;
			padding-inline-start: 40px;
			unicode-bidi: isolate;
		}

		.problem-list {
			list-style-type: none;
		}

		.problem-item {
			padding: 15px;
			margin-bottom: 15px;
			background: rgba(255, 255, 255, 0.5);
			border-radius: 8px;
			backdrop-filter: blur(10px);
			/* box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); */
			border: 1px solid rgba(100, 100, 200, 0.2);
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}

		.problem-item:hover {
			transform: translateY(-5px);
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
		}

		.problem-link {
			color: #6a8cff;
			text-decoration: none;
			font-size: 1.1rem;
			display: block;
			margin-bottom: 5px;
		}

		.problem-link:hover {
			color: #8aafff;
			text-decoration: underline;
		}

		.problem-meta {
			font-size: 0.9rem;
			color: #a0a0c0;
			display: flex;
			justify-content: space-between;
		}

		.giscus-comments {
			min-height: 400px;
		}

		footer {
			text-align: center;
			margin-top: 50px;
			padding: 20px;
			color: #7070a0;
			font-size: 0.9rem;
		}

		.loading {
			text-align: center;
			padding: 20px;
			color: #a0a0c0;
		}

		.error {
			color: #ff6b6b;
			padding: 10px;
			background: rgba(255, 107, 107, 0.1);
			border-radius: 5px;
			margin: 10px 0;
		}

		pre code {
			font-family: 'Consolas' !important;
			display: block !important;
			padding: 12px !important;
			padding-left: 20px !important;
			margin: 2rem 0 !important;
			background: #f8fafc !important;
			border-radius: 10px !important;
			border: 1px solid #e2e8f0 !important;
			color: #1e1e1e !important;
			overflow-x: auto !important;
			overflow-y: auto !important;
			line-height: 1.6 !important;
			font-size: 0.95rem !important;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;
		}

		table {
			border-collapse: collapse !important;
			border-spacing: 0 !important;
			overflow-x: auto;
			min-width: 600px !important;
			font-size: 1rem !important;
			width: 100%;
			margin: 2rem 0;
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			border: 1px solid #e2e8f0;
			background: white;
		}

		thead {
			display: table-header-group;
			vertical-align: middle;
			unicode-bidi: isolate;
			border-color: inherit;
			border-radius: 10px;
		}

		tbody {
			border-radius: 10px;
		}

		tr {
			display: table-row;
			vertical-align: inherit;
			unicode-bidi: isolate;
			border-color: inherit;
		}

		th {
			background: #f8fafc !important;
			font-weight: 600 !important;
			color: #374151 !important;
			border-bottom: 2px solid #e2e8f0 !important;
		}

		th,
		td {
			padding: 12px 16px !important;
			font-size: 1rem !important;
			border-bottom: 1px solid #e2e8f0;
			border-right: 1px solid rgba(34, 36, 38, .1);
			white-space: nowrap;
		}

		table tbody tr:hover {
			background-color: #f8fafc;
		}

		.codecopy-btn {
			opacity: 0.7 !important;
			min-height: 1em;
			outline: 0;
			vertical-align: baseline;
			position: absolute;
			top: 10px !important;
			right: 10px !important;
			background: #f8fafc;
			padding: 6px 10px !important;
			color: rgba(0, 0, 0, 0.6);
			border: 1px solid rgba(0, 0, 0, 0.1);
			box-shadow: transparent 0px 0px 0px 1px inset, rgba(34, 36, 38, 0.15) 0px 0px 0px 0px inset;
			cursor: pointer;
			z-index: 10;
			text-transform: none;
			text-shadow: none;
			font-weight: 700;
			line-height: 1em;
			font-style: normal;
			text-align: center;
			text-decoration: none;
			border-radius: .28571429rem;
			font-size: 0.8rem !important;
			display: inline-block !important;
			padding-block: 1px;
			padding-inline: 6px;
			margin: 0 .25em 0 0;
		}

		.codecopy-btn icon {
			font-weight: 0.8rem !important;
		}

		.codecopy-btn:active {
			background-color: rgb(186, 187, 188);
			color: rgba(0, 0, 0, 0.9);
		}

		.codecopy-btn:hover {
			background: #fff;
			transform: translateY(-1px);
			background-color: rgb(202, 203, 205);
			box-shadow: transparent 0px 0px 0px 1px inset, rgba(34, 36, 38, 0.15) 0px 0px 0px 0px inset;
			color: rgba(0, 0, 0, 0.8);
		}

		.codecopy-btn:focus {
			background-color: rgb(202, 203, 205);
			color: rgba(0, 0, 0, 0.8);
		}

		.sidebar {
			width: 70px;
			height: calc(100vh - 70px);
			position: fixed;
			background: linear-gradient(180deg, #ffffff 0%, #f0f8ff 100%);
			border-right: 2px solid #e6f3ff;
			box-shadow: 2px 0 10px rgba(135, 206, 250, 0.1);
			transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			overflow: hidden;
			backdrop-filter: blur(10px);
			z-index: 900;
			margin-top: 50px;
			margin-left: -20px;
			padding-top: 10px;
			color: #2c3e50;
		}

		.sidebar.expanded {
			width: 250px
		}

		.sidebar-item {
			display: flex;
			align-items: center;
			padding: 15px 23px;
			cursor: pointer;
		}

		.sidebar-item i {
			margin-right: 15px;
			font-size: 18px;
			min-width: 20px;
			width: 20px;
			text-align: center;
		}

		.sidebar-item span {
			opacity: 0;
			visibility: hidden;
			transition: opacity 0.3s ease, visibility 0.3s ease;
			white-space: nowrap;
			overflow: hidden;
		}

		.sidebar.expanded .sidebar-item span {
			opacity: 1;
			visibility: visible;
		}

		.sidebar-item:hover {
			background-color: #f9f9f9
		}
	</style>
</head>

<body>
	<header class="header">
		<div class="logo">YunXing</div>
	</header>
	<div class="sidebar" id="sidebar">
		<div class="sidebar-item" onclick="navigateTo('/')"><i class="fas fa-home"></i><span>首页</span></div>
	</div>
	<div class="container">
		<div class="content-grid">
			<div class="box intro-box">
				<h2 class="box-title"><i class="fas fa-book"></i> 介绍</h2>
				<div class="markdown-content" id="intro-content">
					<div class="loading">加载中...</div>
				</div>
			</div>

			<div class="box new-problems-box">
				<h2 class="box-title"><i class="fas fa-list"></i> 最新题目</h2>
				<div id="new-problems-content">
					<div class="loading">加载中...</div>
				</div>
			</div>

			<div class="box comments-box">
				<h2 class="box-title"><i class="fas fa-comments"></i> 评论</h2>
				<div class="giscus-comments" id="giscus-comments">
					<!-- Giscus评论系统将在这里加载 -->
				</div>
			</div>
		</div>

		<footer>
			<p>YunXing &copy; 2025</p>
		</footer>
	</div>

	<!-- Marked.js for Markdown parsing -->
	<script src="https://cdn.jsdmirror.com/npm/marked/marked.min.js"></script>
	<!-- Katex for math rendering -->
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/katex.min.js"></script>
	<!-- Katex auto-render script -->
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
	<!-- Giscus for comments -->
	<script src="https://unpkg.com/giscus@1.3.0/dist/giscus.js"></script>

	<script>
		// 配置Marked.js以支持Katex和代码高亮
		marked.setOptions({
			highlight: function (code, lang) {
				if (lang && hljs.getLanguage(lang)) {
					return hljs.highlight(code, { language: lang }).value;
				}
				return hljs.highlightAuto(code).value;
			},
			gfm: true
		});

		// 修改顶栏点击事件
		document.querySelector('.logo').addEventListener('click', function () {
			window.location.href = window.location.origin + window.location.pathname;
		});

		// 导航函数
		function navigateTo(path) {
			if (path === '/') {
				// 返回首页
				window.location.href = window.location.origin + window.location.pathname;
			}
		}

		document.addEventListener('DOMContentLoaded', function () {
			const sidebar = document.getElementById('sidebar');
			// const contentArea = document.getElementById('container');

			function expandSidebar() {
				if (sidebar) {
					sidebar.classList.add('expanded');
				}
				// if (contentArea) {
				// 	contentArea.classList.add('expanded');
				// }
			}

			function collapseSidebar() {
				if (sidebar) {
					sidebar.classList.remove('expanded');
				}
				// if (contentArea) {
				// 	contentArea.classList.remove('expanded');
				// }
			}

			if (sidebar) {
				sidebar.addEventListener('touchstart', function (event) {
					expandSidebar();
				});

				sidebar.addEventListener('touchend', function (event) {
					collapseSidebar();
				});

				sidebar.addEventListener('touchleave', function (event) {
					collapseSidebar();
				});

				sidebar.addEventListener('touchcancel', function (event) {
					collapseSidebar();
				});
			}
		});
		document.addEventListener('DOMContentLoaded', function () {
			const sidebar = document.getElementById('sidebar');
			// const contentArea = document.getElementById('contentArea');

			if (sidebar) {
				sidebar.addEventListener('mouseenter', function () {
					sidebar.classList.add('expanded');
				});

				sidebar.addEventListener('mouseleave', function () {
					sidebar.classList.remove('expanded');
				});
			}
		});

		function addCopyButtons() {
			const preElements = document.querySelectorAll('pre code');
			preElements.forEach(codeElement => {
				const button = document.createElement('button');
				button.innerHTML = '<i class="fa-solid fa-copy"></i>';
				button.classList.add('codecopy-btn');

				const div = document.createElement('div');
				div.style = "width:100%;position:relative;";
				div.appendChild(button);
				codeElement.before(div);

				new ClipboardJS(button, {
					text: () => codeElement.innerText.replace(/\n\n/g, "\n")
				}).on('success', e => {
					e.trigger.innerHTML = '<i class="fa-solid fa-check"></i>';
					setTimeout(() => e.trigger.innerHTML = '<i class="fa-solid fa-copy"></i>', 1000);
				}).on('error', e => {
					e.trigger.innerHTML = '<i class="fa-solid fa-xmark"></i>';
					setTimeout(() => e.trigger.innerHTML = '<i class="fa-solid fa-copy"></i>', 1000);
				});
			});
		}

		// 渲染Katex公式
		async function renderMath(element) {
			if (window.renderMathInElement) {
				// 确保KaTeX完全加载后才渲染
				if (window.katex) {
					renderMathInElement(element, {
						delimiters: [
							{ left: "$$", right: "$$", display: true },
							{ left: "\\[", right: "\\]", display: true },
							{ left: "\\(", right: "\\)", display: false },
							{ left: "$", right: "$", display: false }
						],
						throwOnError: false
					});
				} else {
					console.warn("KaTeX core not loaded yet.");
					// 延迟渲染
					setTimeout(() => renderMath(element), 100);
				}
			} else {
				console.warn("KaTeX auto-render script not loaded yet.");
				// 延迟渲染
				setTimeout(() => renderMath(element), 100);
			}
			addCopyButtons();
		}

		// 加载介绍内容
		async function loadIntro() {
			try {
				const response = await fetch('https://raw.bgithub.xyz/SnakeBloc-zym/SnakeBloc-zym.github.io/refs/heads/main/sources/index.md');
				if (!response.ok) throw new Error('无法加载介绍内容');

				const markdown = await response.text();
				const introContent = document.getElementById('intro-content');
				introContent.innerHTML = marked.parse(markdown);

				// 等待DOM更新后渲染公式
				await new Promise(resolve => setTimeout(resolve, 0));
				await renderMath(introContent);
			} catch (error) {
				document.getElementById('intro-content').innerHTML =
					`<div class="error">加载介绍内容时出错: ${error.message}</div>`;
			}
		}

		// 加载最新题目
		async function loadNewProblems() {
			try {
				const response = await fetch('https://raw.bgithub.xyz/SnakeBloc-zym/SnakeBloc-zym.github.io/refs/heads/main/sources/newp.json');
				if (!response.ok) throw new Error('无法加载最新题目');

				const data = await response.json();
				const problemsContent = document.getElementById('new-problems-content');

				if (data.problems && data.problems.length > 0) {
					let html = '<ul class="problem-list">';
					data.problems.forEach(problem => {
						html += `
            <li class="problem-item">
              <a href="?id=${problem.id}" class="problem-link">${problem.title}</a>
              <div class="problem-meta">
                <span>难度: ${problem.difficulty}</span>
                <span>${problem.date}</span>
              </div>
            </li>
          `;
					});
					html += '</ul>';
					problemsContent.innerHTML = html;
				} else {
					problemsContent.innerHTML = '<p>暂无最新题目</p>';
				}
			} catch (error) {
				document.getElementById('new-problems-content').innerHTML =
					`<div class="error">加载最新题目时出错: ${error.message}</div>`;
			}
		}

		// 添加问题页面处理
		const urlParams = new URLSearchParams(window.location.search);
		const problemId = urlParams.get('id');

		if (problemId) {
			// 题目页面
			document.querySelector('.intro-box').style.display = 'none';
			document.querySelector('.new-problems-box').style.display = 'none';

			const problemBox = document.createElement('div');
			problemBox.className = 'box';
			problemBox.innerHTML = `
      <!-- <h2 class="box-title"><i class="fas fa-book"></i> 题目: ${problemId}</h2> -->
      <div class="markdown-content" id="problem-content">
        <div class="loading">加载中...</div>
      </div>
    `;
			document.querySelector('.content-grid').insertBefore(problemBox, document.querySelector('.comments-box'));

			// 使用jsDelivr CDN加载题目内容
			const mdUrl = `https://raw.bgithub.xyz/SnakeBloc-zym/SnakeBloc-zym.github.io/refs/heads/main/sources/problem/${problemId}.md`;

			fetch(mdUrl)
				.then(response => {
					if (!response.ok) throw new Error('题目不存在');
					return response.text();
				})
				.then(markdown => {
					document.getElementById('problem-content').innerHTML = marked.parse(markdown);
					// 渲染KaTeX公式
					if (window.renderMathInElement) {
						renderMathInElement(document.getElementById('problem-content'), {
							delimiters: [
								{ left: "$$", right: "$$", display: true },
								{ left: "\\[", right: "\\]", display: true },
								{ left: "\\(", right: "\\)", display: false },
								{ left: "$", right: "$", display: false }
							],
							throwOnError: false
						});
					}
				})
				.catch(error => {
					document.getElementById('problem-content').innerHTML =
						`<div class="error">加载题目时出错: ${error.message}</div>`;
				});
		} else {
			// 主页，修复加载问题
			loadIntro();
			loadNewProblems();
			initGiscus();
		}

		// 初始化Giscus评论系统
		function initGiscus() {
			const giscusContainer = document.getElementById('giscus-comments');

			// 创建Giscus脚本元素
			const script = document.createElement('script');
			script.src = 'https://giscus.app/client.js';
			script.setAttribute('data-repo', '[在此输入您的仓库]');
			script.setAttribute('data-repo-id', '[在此输入仓库ID]');
			script.setAttribute('data-category', '[在此输入分类]');
			script.setAttribute('data-category-id', '[在此输入分类ID]');
			script.setAttribute('data-mapping', 'pathname');
			script.setAttribute('data-strict', '0');
			script.setAttribute('data-reactions-enabled', '1');
			script.setAttribute('data-emit-metadata', '0');
			script.setAttribute('data-input-position', 'bottom');
			script.setAttribute('data-theme', 'dark');
			script.setAttribute('data-lang', 'zh-CN');
			script.setAttribute('crossorigin', 'anonymous');
			script.async = true;

			giscusContainer.appendChild(script);
		}

		// 页面加载完成后初始化
		document.addEventListener('DOMContentLoaded', () => {
			loadIntro();
			loadNewProblems();
			initGiscus();
		});

		document.addEventListener('DOMContentLoaded', () => {
			if (window.renderMathInElement) {
				renderMathInElement(document.body, {
					delimiters: [
						{ left: "$$", right: "$$", display: true },
						{ left: "\\[", right: "\\]", display: true },
						{ left: "\\(", right: "\\)", display: false },
						{ left: "$", right: "$", display: false }
					],
					throwOnError: false
				});
			}
		});
	</script>

	<script>
		// 确保所有库都加载完成后渲染页面中的数学公式
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', renderAllMath);
		} else {
			// DOM 已经加载完成
			setTimeout(renderAllMath, 100);
		}

		function renderAllMath() {
			if (window.katex && window.renderMathInElement) {
				// 等待所有内容完全渲染
				setTimeout(() => {
					renderMathInElement(document.body, {
						delimiters: [
							{ left: "$$", right: "$$", display: true },
							{ left: "\\[", right: "\\]", display: true },
							{ left: "\\(", right: "\\)", display: false },
							{ left: "$", right: "$", display: false }
						],
						throwOnError: false
					});
				}, 200); // 给Marked.js一些时间渲染Markdown
			} else {
				// 如果库还没加载完，再等一下
				setTimeout(renderAllMath, 100);
			}
		}
	</script>
</body>

</html>
